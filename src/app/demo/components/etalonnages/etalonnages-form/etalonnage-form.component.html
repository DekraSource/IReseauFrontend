<!-- etalonnage-form.component.html -->
<div class="p-4">
  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="p-fluid">
    <div class="grid form-grid">

      <!-- Type d’intervention -->
      <div class="col-12 md:col-6 field">
        <div class="p-field">
          <label for="interventionTypeId">Type d’intervention</label>
          <p-dropdown 
            id="interventionTypeId" 
            [options]="interventionTypes" 
            formControlName="interventionTypeId" 
            optionLabel="values" 
            optionValue="key" 
            [disabled]="isEdit && etalonnage.interventionTypeId === 1"
            placeholder="Sélectionner le type d’intervention"
            appendTo="body"
            styleClass="w-full">
          </p-dropdown>
          <small *ngIf="form.get('interventionTypeId')?.invalid && form.get('interventionTypeId')?.touched" class="p-error">
            Le type d’intervention est requis
          </small>
        </div>
      </div>

      <!-- Date intervention / étalonnage -->
      <div class="col-12 md:col-6 field">
        <div class="p-field">
          <label for="dateIntervention">{{isEtalonnage ? 'Date d’étalonnage' : 'Date d’intervention'}}</label>
          <p-calendar 
            id="dateIntervention" 
            formControlName="dateIntervention" 
            [showIcon]="true" 
            dateFormat="dd/mm/yy" 
            appendTo="body"
            styleClass="w-full">
          </p-calendar>
          <small *ngIf="form.get('dateIntervention')?.invalid && form.get('dateIntervention')?.touched" class="p-error">
            La date est requise
          </small>
        </div>
      </div>

      <!-- Expiration mois -->
      <div class="col-12 md:col-6 field" *ngIf="isEtalonnage">
        <div class="p-field">
          <label for="moisExpiration">Expire après</label>
          <p-dropdown 
            id="moisExpiration" 
            [options]="[6, 24]" 
            formControlName="moisExpiration" 
            placeholder="Sélectionner la durée"
            appendTo="body"
            styleClass="w-full">
            <ng-template let-item pTemplate="item">
              {{item}} mois
            </ng-template>
          </p-dropdown>
        </div>
      </div>

      <!-- Date expiration -->
      <div class="col-12 md:col-6 field" *ngIf="isEtalonnage && expirationDate">
        <div class="p-field">
          <label>Date d’expiration de l’étalonnage</label>
          <input pInputText [value]="expirationDate" readonly class="w-full" />
        </div>
      </div>

      <!-- Constats -->
      <div class="col-12 md:col-6 field">
        <div class="p-field">
          <label for="constats">Constats</label>
          <textarea 
            id="constats" 
            pInputTextarea 
            formControlName="constats" 
            rows="3" 
            placeholder="Saisir vos constats"
            class="w-full">
          </textarea>
        </div>
      </div>

      <!-- Fichier PDF -->
      <div class="col-12 md:col-6 field">
        <div class="p-field">
          <label for="file">Rapport d’intervention (.pdf)</label>
          <p-fileUpload 
            id="file" 
            mode="basic" 
            chooseLabel="Parcourir" 
            [showUploadButton]="false" 
            [showCancelButton]="false"
            accept=".pdf" 
            (onSelect)="onFileSelect($event)" 
            [maxFileSize]="2000000"
            appendTo="body"
            styleClass="w-full">
          </p-fileUpload>
          <small *ngIf="!isEdit && files.length === 0" class="p-error">
            Veuillez joindre un fichier
          </small>
        </div>
      </div>
    </div>

    <!-- Boutons -->
    <div class="p-dialog-footer p-d-flex p-flex-column md:p-flex-row md:p-jc-end p-mt-3 gap-2">
      <button 
        pButton 
        type="button" 
        label="Annuler" 
        icon="pi pi-times" 
        class="p-button-text p-button-secondary w-full md:w-auto" 
        (click)="onCancel()">
      </button>
      <button 
        pButton 
        type="submit" 
        label="Enregistrer" 
        icon="pi pi-check" 
        class="p-button-success w-full md:w-auto" 
        [disabled]="loading">
      </button>
    </div>
  </form>
</div>
